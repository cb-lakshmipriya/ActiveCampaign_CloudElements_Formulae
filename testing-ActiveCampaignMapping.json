{"id":29309,"name":"testing-ActiveCampaignMapping","userId":27893,"accountId":24428,"createdDate":"2019-09-03T05:28:40Z","steps":[{"id":213934,"onSuccess":["loopOverLists"],"onFailure":[],"name":"addOption","type":"script","properties":{"body":"let options = {};\nif(steps.addOption !== undefined) {\n  options = steps.addOption;\n}\n\nvar str = JSON.stringify(steps.loopOverLists.entry.name);\noptions[steps.loopOverLists.entry.id] = str;\ndone(options);"}},{"id":213935,"onSuccess":["ChargebeeGetFields"],"onFailure":[],"name":"ChargebeeConfigParams","type":"script","properties":{"body":"let params=JSON.parse(trigger.args.request.query['ChargebeeConfigParams']);\n\nlet apiKey= params.apiKey;\nlet siteName= params.siteName;\nlet siteDomain= params.siteDomain;\nlet type= params.type;\n\nlet body = {\n  input: {\n    config :{\n      url: \"https://\"+siteName+\".integrations.\"+siteDomain+\"/integrations/api/get_custom_field_list\",\n      headers:{\n        Authorization: \"Basic \" + CE.b64(apiKey + \":\" + \"\")\n      },\n      query:{\n        site_name: siteName,\n        api_key: apiKey\n      },\n      apiKey: apiKey,\n      siteName: siteName,\n      siteDomain: siteDomain,\n      type: type\n    }\n  }\n};\n\ndone(body);"}},{"id":264166,"onSuccess":["gotFields"],"onFailure":[],"name":"ChargebeeGetFields","type":"formula","properties":{"args":"${steps.ChargebeeConfigParams.input.config}","formulaId":"31257"}},{"id":213936,"onSuccess":[],"onFailure":[],"name":"checkListResult","type":"script","properties":{"body":"let mapping_step = {\n   \"code\" : \"200\",\n  \"cardStatus\": \"MAPPING-FAILED\",\n  \"lists\": steps.addOption,\n  \"cardResult\" : {\n        \"cards\": [{\n          \"card\": {\n            \"type\" : \"ACTION\",\n            \"heading\" : \"Success\",\n            \"subHeading\" : \"Success\",\n            \"icon\" : \"ERROR\"         \n         },\n         \"id\" : \"check3\",\n         \"isCardDone\":\"true\"\n        }\n        ]\n    }\n}\n\n\ndone(mapping_step);\n"}},{"id":213937,"onSuccess":[],"onFailure":[],"name":"ConfigError","type":"script","properties":{"body":"let error = {\n  \"code\" : \"403\",\n  \"cardStatus\": \"MAPPING-FAILED\",\n  \"cardResult\": {\n    \"cards\": [{\n      \"card\": {\n\t\t\t    \"type\" : \"ACTION\",\n\t\t\t    \"heading\": \"ActiveCampaign key has been expired\",\n\t\t\t    \"subHeading\" : \"Looks like your ActiveCampaign key  is expired. Please resolve this and sync again.\",\n\t\t\t    \"icon\" : \"ERROR\",\n\t\t\t},\n\t\t\t\n         \"id\" : \"check3\",\n         \"isCardDone\":\"true\"\n    }]\n  }\n}\ndone(error)"}},{"id":213938,"onSuccess":["getLists"],"onFailure":[],"name":"ConfigParams","type":"script","properties":{"body":"let params = {};\nparams.options = {};\nparams.list = '';\nlet customFieldToggle = trigger.args.request.query['customFieldToggle'];\n\nif(trigger.args.request.query['list'] !== undefined) {\n  params.list = trigger.args.request.query['list'];\n}\nparams.deleteops = '';\nif(trigger.args.request.query['deleteops'] !== undefined) {\n  params.deleteops = trigger.args.request.query['deleteops']\n}\nparams.syncGift = '';\nif(trigger.args.request.query['syncGift'] !== undefined) {\n  params.syncGift = trigger.args.request.query['syncGift']\n}\nif(customFieldToggle !== undefined){\n  params.customFieldToggle = customFieldToggle;\n}\nelse{\nparams.customFieldToggle = \"false\";\n}\n\n\ndone(params);"}},{"id":213939,"onSuccess":[],"onFailure":[],"name":"Error","type":"script","properties":{"body":"let mapping_step = {\n   \"code\" : \"404\",\n  \"cardStatus\": \"MAPPING-FAILED\",\n  \"cardResult\" : {\n        \"cards\": [{\n          \"card\": {\n            \"type\" : \"ACTION\",\n            \"heading\" : \"List unavailable in ActiveCampaign\",\n            \"subHeading\" : \"There isn't any list available in ActiveCampaign. It is essential to have a list created in ActiveCampaign to set up this integration.\",\n            \"icon\" : \"ERROR\"         \n         },\n         \"id\" : \"check3\",\n         \"isCardDone\":\"true\"\n        }\n        ]\n    }\n}\n\n\ndone(mapping_step);\n"}},{"id":213940,"onSuccess":["Success"],"onFailure":[],"name":"getChargebeeFields","type":"httpRequest","properties":{"query":"${steps.ChargebeeConfigParams.input.config.query}","method":"GET","headers":"${steps.ChargebeeConfigParams.input.config.auth}","url":"${steps.ChargebeeConfigParams.input.config.url}"}},{"id":213941,"onSuccess":["loopOverLists"],"onFailure":["ConfigError"],"name":"getLists","type":"elementRequest","properties":{"method":"GET","elementInstanceId":"${config.activecampaign}","api":"/lists"}},{"id":264167,"onSuccess":["Success"],"onFailure":["Error"],"name":"gotFields","type":"filter","properties":{"body":"if(steps.ChargebeeGetFields.cb_status === \"success\"){\n  done(true);\n}\n\ndone(false);"}},{"id":213942,"onSuccess":["IsCheckList"],"onFailure":["Error"],"name":"HasOptions","type":"filter","properties":{"body":"if(steps.addOption !==undefined){\n  done(true);\n}else{\n  done(false);\n}"}},{"id":213943,"onSuccess":["isMappingPresent"],"onFailure":["checkListResult"],"name":"IsCheckList","type":"filter","properties":{"body":"if(trigger.args.request.query['checkList'] !== undefined){\n  done(false);\n}\ndone(true);"}},{"id":213944,"onSuccess":["ChargebeeConfigParams"],"onFailure":[],"name":"isMappingPresent","type":"script","properties":{"body":"let deleteops=trigger.args.request.query['deleteops'];\nlet syncGift=trigger.args.request.query['syncGift'];\nlet modelbox_check1=trigger.args.request.query['modelbox_check1'];\nlet modelbox_check2=trigger.args.request.query['modelbox_check2'];\n\nlet input={};\n\ninput.subscriptionFields={};\ninput.customerFields={};\n\n\nif(deleteops!==undefined){\n  input.deleteops=deleteops;\n  input.syncGift=syncGift;\n}\nif(modelbox_check1!==undefined && modelbox_check1!==\"\"){\n  \n  modelbox_check1=JSON.parse(modelbox_check1);\n  modelbox_check1=JSON.parse(modelbox_check1.search);\n  if(Object.keys(modelbox_check1).length!==0){\n  input.subscriptionFields=modelbox_check1;\n  }\n}\n\nif(modelbox_check2!==undefined && modelbox_check2!==\"\"){\n  \n  modelbox_check2=JSON.parse(modelbox_check2);\n modelbox_check2=JSON.parse(modelbox_check2.search2);\n  if(Object.keys(modelbox_check2).length!==0){\n  input.customerFields=modelbox_check2;\n  }\n}\n\ndone(input);"}},{"id":213945,"onSuccess":["addOption"],"onFailure":["HasOptions"],"name":"loopOverLists","type":"loop","properties":{"list":"${steps.getLists.response.body.lists}"}},{"id":213946,"onSuccess":[],"onFailure":[],"name":"Success","type":"script","properties":{"body":"let inputs=steps.isMappingPresent;\nlet chargebeeFields=JSON.parse(steps.ChargebeeGetFields.data.response);\n\nlet mapping_step = {\n  \"cardStatus\": \"MAPPING-SUCCESS\",\n  \"cardResult\" : {\n        \"cards\": [{\n                \"card\": {\n                    \"type\": \"INPUT\",\n                    \"params\": [{\n                        \"dispName\": \"Choose the ActiveCampaign list to sync customer and subscription data with \",\n                        \"req\": \"true\",\n                        \"type\": \"DROPDOWN\",\n                        \"id\": \"list\",\n                        \"allowedValues\": steps.addOption,\n                        \"defaultVal\": steps.ConfigParams.list\n                    }]\n                },\n                \"id\": \"check2\"\n            },\n            {\n                \"card\": {\n                    \"type\": \"INPUT\",\n                    \"params\": [{\n                        \"dispName\": \"Choose what happens when a customer is deleted in Chargebee\",\n                        \"desc\": \"You can choose to remove the customer from ActiveCampaign or mark them as 'Deleted'.\",\n                        \"req\": \"true\",\n                        \"type\": \"DROPDOWN\",\n                        \"id\": \"deleteops\",\n                        \"allowedValues\": {\n                            \"option1\": \"Mark as Deleted\",\n                            \"option2\": \"Remove Customer\"\n                        },\n                        \"defaultVal\": steps.ConfigParams.deleteops\n                    }]\n                },\n                \"id\": \"check2\"\n            },\n            {\n                \"card\": {\n                    \"type\": \"INPUT\",\n                    \"params\": [{\n                        \"dispName\": \"Sync customers who have purchased a gift subscription for someone else\",\n                        \"desc\": \"Applicable if you have enabled gift subscriptions in Chargebee.\",\n                        \"type\": \"TOGGLE\",\n                        \"id\": \"syncGift\",\n                         \"defaultVal\": steps.ConfigParams.syncGift\n                    \n                    }]\n                },\n                \"id\": \"check3\"\n            }\n        ]\n    }\n};\n\n\n\nlet customField_UI = {\n    \"card\": {\n        \"type\": \"TOGGLE_HIDE_INPUT\",\n        \"message\":{\n\t      \"message\":\"We already sync 18+ customer and subscription fields from Chargebee to ActiveCampaign. If you want to sync any additional fields from Chargebee, including your custom fields created in Chargebee, you can do it by enabling this configuration.\",\n\t      \"button\": {\n           \"display\": \"View fields\",     \n           \"icon\": \"ARROW\",       \n           \"id\": \"errors\",     \n           \"type\": \"DIRECT_LINK\",\t   \n           \"newTab\":\"true\",\n           \"url\": \"https://www.chargebee.com/docs/active-campaign.html\"\n      \n         }\n\t \t     \n\t    },\n        \"params\": [\n            {\n                \"dispName\": \"Map additional fields from Chargebee to ActiveCampaign\",\n                \"req\": \"true\",\n                \"type\": \"TOGGLE\",\n                \"id\": \"toggle2\",\n                 \"defaultVal\": steps.ConfigParams.customFieldToggle\n\n\n            },\n            {\n                \"dispName\": \"Subscription fields\",\n                \"type\": \"MODELBOX_INPUT_FIELDS\",\n                \"id\": \"modelbox_check1\",\n                \"inputFields\": [\n                    {\n                        \"type\": \"SEARCH_CHECK_BOX\",\n                        \"id\": \"search\",\n                        \"checkboxes\": [\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"billing_period\",\n                                \"desc\": \"Billing Period\",\n                                \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.billing_period ? \"on\" : \"off\")\n\n                               \n                            },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"plan_free_quantity\",\n                            //     \"desc\": \"Plan Free Quantity\",\n                            //     \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.plan_free_quantity ? \"on\" : \"off\")\n                                \n                            // },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"has_scheduled_changes\",\n                            //     \"desc\": \"Has Scheduled Changes\",\n                            //     \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.has_scheduled_changes ? \"on\" : \"off\")\n                            // },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"due_invoices_count\",\n                                \"desc\": \"Due Invoices Count\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.due_invoices_count ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"plan_quantity\",\n                                \"desc\": \"Plan Quantity\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.plan_quantity ? \"on\" : \"off\")\n                            },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"resource_version\",\n                            //     \"desc\": \"Resource Version\",\n                            //     \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.resource_version ? \"on\" : \"off\")\n                            // },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"plan_unit_price\",\n                                \"desc\": \"Plan Unit Price\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.plan_unit_price ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"customer_id\",\n                                \"desc\": \"Customer Id\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.customer_id ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"auto_collection\",\n                                \"desc\": \"Auto Collection\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.auto_collection ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"billing_period_unit\",\n                                \"desc\": \"Billing Period Unit\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.billing_period_unit ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"current_term_end\",\n                                \"desc\": \"Current Term End\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.current_term_end ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"current_term_start\",\n                                \"desc\": \"Current Term Start\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.current_term_start ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"deleted\",\n                                \"desc\": \"Subscription Deleted\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.deleted ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"due_since\",\n                                \"desc\": \"Due Since\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.due_since ? \"on\" : \"off\")\n                            },\n                             {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"total_dues\",\n                                \"desc\": \"Total Dues\",\n                                 \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields.total_dues ? \"on\" : \"off\")\n                            }\n                            \n                        ]}]},\n                        \n                \n            {\n                \"dispName\": \"Customer fields\",\n                \"type\": \"MODELBOX_INPUT_FIELDS\",\n                \"id\": \"modelbox_check2\",\n                \"inputFields\": [\n                    {\n                        \"type\": \"SEARCH_CHECK_BOX\",\n                        \"id\": \"search2\",\n                        \"checkboxes\": [\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"allow_direct_debit\",\n                            //     \"desc\": \"Allow Direct Debit\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.allow_direct_debit ? \"on\" : \"off\")\n                                \n                            // },\n                             {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"auto_collection\",\n                                \"desc\": \"Auto Collection\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.auto_collection ? \"on\" : \"off\")\n                            },\n                             {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"card_status\",\n                                \"desc\": \"Card Status\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.card_status ? \"on\" : \"off\")\n                            },\n                            \n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"created_on\",\n                                \"desc\": \"Created On\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.created_on ? \"on\" : \"off\")\n                            },\n                            \n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"email\",\n                            //     \"desc\": \"Email\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.email ? \"on\" : \"off\")\n                            // },\n                            \n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"excess_payments\",\n                                \"desc\": \"Excess Payments\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.excess_payments ? \"on\" : \"off\")\n                            },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"id\",\n                                \"desc\": \"Customer Id\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.id ? \"on\" : \"off\")\n                            },\n                            \n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"locale\",\n                            //     \"desc\": \"Locale\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.locale ? \"on\" : \"off\")\n                            // },\n                            \n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"net_term_days\",\n                                \"desc\": \"Net Term Days\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.net_term_days ? \"on\" : \"off\")\n                            },\n                            \n                           \n                             \n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"pii_cleared\",\n                            //     \"desc\": \"Pii Cleared\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.pii_cleared ? \"on\" : \"off\")\n                            // },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"preferred_currency_code\",\n                                \"desc\": \"Preferred Currency Code\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.preferred_currency_code ? \"on\" : \"off\")\n                            },\n                            \n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"promotional_credits\",\n                            //     \"desc\": \"Promotional Credits\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.promotional_credits ? \"on\" : \"off\")\n                            // },\n                            \n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"refundable_credits\",\n                            //     \"desc\": \"Refundable Credits\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.total_dues ? \"on\" : \"off\")\n                            // },\n                            \n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"resource_version\",\n                            //     \"desc\": \"Resource Version\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.refundable_credits ? \"on\" : \"off\")\n                            // // },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"taxability\",\n                            //     \"desc\": \"Taxability\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.taxability ? \"on\" : \"off\")\n                            // },\n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"unbilled_charges\",\n                                \"desc\": \"Unbilled Charges\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.unbilled_charges ? \"on\" : \"off\")\n                            },\n                            \n                            {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": \"updated_at\",\n                                \"desc\": \"Updated On\",\n                                 \"defaultVal\":(inputs.customerFields && inputs.customerFields.updated_at ? \"on\" : \"off\")\n                            }\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_city\",\n                            //     \"desc\": \"BillingAddress.City\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.total_dues ? \"on\" : \"off\")\n                            // }\n                            // ,\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_country\",\n                            //     \"desc\": \"BillingAddress.Country\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.billing_address_country ? \"on\" : \"off\")\n                            // },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_first_name\",\n                            //     \"desc\": \"BillingAddress.FirstName\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.billing_address_first_name ? \"on\" : \"off\")\n                            // },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_last_name\",\n                            //     \"desc\": \"BillingAddress.LastName\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.billing_address_last_name ? \"on\" : \"off\")\n                            // }\n                            // ,\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_line1\",\n                            //     \"desc\": \"BillingAddress.Line1\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.billing_address_line1 ? \"on\" : \"off\")\n                            // },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_object\",\n                            //     \"desc\": \"BillingAddress.Object\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.billing_address_object ? \"on\" : \"off\")\n                            // },\n                            // {\n                            //     \"type\": \"CHECKBOX\",\n                            //     \"id\": \"billing_address_state\",\n                            //     \"desc\": \"BillingAddress.State\",\n                            //     \"defaultVal\":(inputs.customerFields && inputs.customerFields.billing_address_state ? \"on\" : \"off\")\n                            // }\n                        ]\n                    }\n                ]\n            }\n        ]\n    },\n    \"id\": \"check4\"\n};\n\nmapping_step.cardResult.cards.push(customField_UI);\n\nlet CbCustomerfieldsKeys=Object.keys(chargebeeFields.customer_custom_fields);\nlet CbSubscriptionfieldsKeys=Object.keys(chargebeeFields.subscription_custom_fields);\n\nfor(var i=0;i<CbSubscriptionfieldsKeys.length;++i){\n  customField_UI.card.params[1].inputFields[0].checkboxes.push( {\n                                \"type\": \"CHECKBOX\",\n                                \"id\": CbSubscriptionfieldsKeys[i],\n                                \"desc\": chargebeeFields.subscription_custom_fields[CbSubscriptionfieldsKeys[i]],\n                                \"defaultVal\":(inputs.subscriptionFields && inputs.subscriptionFields[CbSubscriptionfieldsKeys[i]] ? \"on\" : \"off\")\n                            });\n}\n\n\n\n\nfor(var j=0;j<CbCustomerfieldsKeys.length;++j){\n  customField_UI.card.params[2].inputFields[0].checkboxes.push({\n                                \"type\": \"CHECKBOX\",\n                                \"id\": CbCustomerfieldsKeys[j],\n                                \"desc\": chargebeeFields.customer_custom_fields[CbCustomerfieldsKeys[j]],\n                                \"defaultVal\":(inputs.customerFields && inputs.customerFields[CbCustomerfieldsKeys[j]] ? \"on\" : \"off\")\n                            });\n}\n\n\ndone(mapping_step);"}}],"triggers":[{"id":25944,"onSuccess":["ConfigParams"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"subFormulas":[{"id":31257,"name":"ChargebeeGet","userId":27893,"accountId":24428,"createdDate":"2019-11-12T11:30:28Z","steps":[{"id":245638,"onSuccess":["ChargebeeGetCBDelay2"],"onFailure":["ChargebeeGetResult"],"name":"ChargebeeGetCallAgainCB","type":"filter","properties":{"body":"//done(false); //Since delay causing 30 second limit issues\n\n\nif(steps.ChargebeeGetInputParams.intervel.length > 0 && steps.ChargebeeGetInputParams.retryCode[steps.ChargebeeGetGetCBData.response.code] !== undefined) {\n  steps.ChargebeeGetInputParams.delay.query.delay = steps.ChargebeeGetInputParams.intervel.pop();\n  done(true);\n}else {\n  done(false);\n}\n"}},{"id":245636,"onSuccess":["ChargebeeGetCBDelay"],"onFailure":["ChargebeeGetResult2"],"name":"ChargebeeGetCallAgainHttp","type":"filter","properties":{"body":"done(false); //Since delay causing 30 second limit issues\n\nif(steps.ChargebeeGetInputParams.intervel.length > 0 && steps.ChargebeeGetInputParams.retryCode[steps.ChargebeeGetGetHttpData.response.code] !== undefined) {\n  steps.ChargebeeGetInputParams.delay.query.delay = steps.ChargebeeGetInputParams.intervel.pop();\n  done(true);\n}else {\n  done(false);\n}\n"}},{"id":245637,"onSuccess":["ChargebeeGetGetHttpData"],"onFailure":[],"name":"ChargebeeGetCBDelay","type":"httpRequest","properties":{"query":"${steps.ChargebeeGetInputParams.delay.query}","method":"GET","headers":"${steps.ChargebeeGetInputParams.delay.headers}","url":"${steps.ChargebeeGetInputParams.delay.url}"}},{"id":245639,"onSuccess":["ChargebeeGetGetCBData"],"onFailure":[],"name":"ChargebeeGetCBDelay2","type":"httpRequest","properties":{"query":"${steps.ChargebeeGetInputParams.delay.query}","method":"GET","headers":"${steps.ChargebeeGetInputParams.delay.headers}","url":"${steps.ChargebeeGetInputParams.delay.url}"}},{"id":244768,"onSuccess":[],"onFailure":[],"name":"ChargebeeGetError","type":"script","properties":{"body":"done({\n  cb_status:\"failure\",\n  cb_error_code:\"formula_invalid_url\"\n});"}},{"id":244769,"onSuccess":["ChargebeeGetCallAgainCB"],"onFailure":["ChargebeeGetCallAgainCB"],"name":"ChargebeeGetGetCBData","type":"elementRequest","properties":{"query":"${steps.ChargebeeGetInputParams.query}","body":"","elementInstanceId":"${config.chargebee}","method":"GET","headers":"${steps.ChargebeeGetInputParams.headers}","acceptableStatusCodes":"200-600","api":"${steps.ChargebeeGetInputParams.url}"}},{"id":244774,"onSuccess":["ChargebeeGetCallAgainHttp"],"onFailure":["ChargebeeGetCallAgainHttp"],"name":"ChargebeeGetGetHttpData","type":"httpRequest","properties":{"query":"${steps.ChargebeeGetInputParams.query}","body":"","method":"GET","headers":"${steps.ChargebeeGetInputParams.headers}","acceptableStatusCodes":"200-600","url":"${steps.ChargebeeGetInputParams.url}"}},{"id":244764,"onSuccess":["ChargebeeGetIsValidUrl"],"onFailure":[],"name":"ChargebeeGetInputParams","type":"script","properties":{"body":"let url = trigger.args.url;\nlet query = trigger.args.query;\nlet apiKey = trigger.args.apiKey;\nlet headers = trigger.args.headers;\nlet siteDomain = trigger.args.siteDomain;\nlet siteName = trigger.args.siteName;\nlet type = trigger.args.type;\n\n\nlet intervel = [];\nintervel.push(5000);\nintervel.push(4000);\nintervel.push(3000);\nintervel.push(2000);\nintervel.push(1000);\n\nif (query === undefined) {\n    query = {};\n}\nif (headers === undefined) {\n    headers = {};\n}\ndone({\n    url: url,\n    query: query,\n    //intervel:[5000,10000,20000,40000,80000],\n    intervel: intervel,\n    retryCode: {\n        503: true,\n        429: true,\n        502: true,\n        403: true,\n        400: true,\n    },\n    hardStop: {\n        503: true,\n        429: true,\n        502: true,\n        403: true,\n        400: true,\n        500:true,\n        401:true\n    },\n    headers: headers,\n    delay: {\n        url: \"https://\" + siteName + \".integrations.\" + siteDomain + \"/api/ipaasdelay\",\n        query: {\n            delay: 2000\n        },\n        headers: {\n            \"api_key\": apiKey\n        }\n    }\n});"}},{"id":244771,"onSuccess":["ChargebeeGetGetHttpData"],"onFailure":["ChargebeeGetGetCBData"],"name":"ChargebeeGetIsHttp","type":"filter","properties":{"body":"done(steps.ChargebeeGetInputParams.url.startsWith(\"https://\"));"}},{"id":244767,"onSuccess":["ChargebeeGetIsHttp"],"onFailure":["ChargebeeGetError"],"name":"ChargebeeGetIsValidUrl","type":"filter","properties":{"body":"done(steps.ChargebeeGetInputParams.url !== undefined && steps.ChargebeeGetInputParams.url!== \"\");"}},{"id":244770,"onSuccess":[],"onFailure":[],"name":"ChargebeeGetResult","type":"script","properties":{"body":"if(steps.ChargebeeGetGetCBData.response.code < 300) {\n  done({\n    cb_status:\"success\",\n    cb_code: steps.ChargebeeGetGetCBData.response.code,\n    data:steps.ChargebeeGetGetCBData.response.body\n  });\n}else {\n  let cb_error_code = \"formula_default_error\";\n\n  let hardstop = steps.ChargebeeGetInputParams.hardStop[steps.ChargebeeGetGetCBData.response.code] !== undefined;\n  if(steps.ChargebeeGetGetCBData.response!== undefined && steps.ChargebeeGetGetCBData.response.body!== undefined && steps.ChargebeeGetGetCBData.response.body.error_code !== undefined) {\n    cb_error_code = steps.ChargebeeGetGetCBData.response.body.error_code;\n    let cbcode = steps.ChargebeeGetGetCBData.response.code || 404;\n  }\n  done({\n    cb_status:\"failure\",\n    cb_error_code:cb_error_code,\n    cb_code: cbcode,\n    cb_exit:hardstop\n  });\n}\n\n"}},{"id":244775,"onSuccess":[],"onFailure":[],"name":"ChargebeeGetResult2","type":"script","properties":{"body":"if(steps.ChargebeeGetGetHttpData.response.code <300) {\n  done({\n    cb_status:\"success\",\n    cb_code: steps.ChargebeeGetGetHttpData.response.code,\n    data:steps.ChargebeeGetGetHttpData.response.body\n  });\n}else {\n  let cb_error_code = \"formula_default_error\";\n\n  let hardstop = steps.ChargebeeGetInputParams.hardStop[steps.ChargebeeGetGetHttpData.response.code] !== undefined;\n  if(steps.ChargebeeGetGetHttpData.response.body!== undefined && steps.ChargebeeGetGetHttpData.response.body.error_code !== undefined) {\n    cb_error_code = steps.ChargebeeGetGetHttpData.response.body.error_code;\n  }\n  done({\n    cb_status:\"failure\",\n    cb_error_code:cb_error_code,\n    cb_exit:hardstop,\n    cb_code: steps.ChargebeeGetGetHttpData.response.code\n  });\n}\n\n"}}],"triggers":[{"id":27722,"onSuccess":["ChargebeeGetInputParams"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"engine":"v3","active":true,"debugLoggingEnabled":false,"singleThreaded":false,"configuration":[{"id":59935,"key":"chargebee","name":"chargebee","type":"elementInstance","required":true}]}],"method":"GET","uri":"/activecampaign/mapping","engine":"v1","active":true,"debugLoggingEnabled":true,"singleThreaded":false,"api":"GET /activecampaign/mapping","configuration":[{"id":53171,"key":"activecampaign","name":"activecampaign","type":"elementInstance","required":true}]}